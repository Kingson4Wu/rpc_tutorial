name: Project Health Check

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  health-check:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    # Setup Go for gateway
    - name: Setup Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.19'

    # Setup Java for java-server
    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '11'
        cache: 'maven'

    # Setup Python for python-server
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        cache: 'pip'

    # Setup Node for vue-client
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    # Build Gateway
    - name: Build Gateway
      run: |
        cd gateway
        go mod tidy
        go build -v .

    # Build Java Server
    - name: Build Java Server
      run: |
        cd java-server
        chmod +x ./mvnw
        ./mvnw clean compile

    # Install Python dependencies
    - name: Install Python Dependencies
      run: |
        cd python-server
        pip install -r requirements.txt

    # Install and check Vue Client dependencies (without building to avoid lint issues)
    - name: Install Vue Client Dependencies
      run: |
        cd vue-client
        npm ci
        ls -la

    # Basic structure check
    - name: Verify Project Structure
      run: |
        test -f README.md && echo "✓ README.md exists"
        test -f docker-compose.yml && echo "✓ docker-compose.yml exists"
        test -f envoy.yaml && echo "✓ envoy.yaml exists"
        test -d gateway && echo "✓ gateway directory exists"
        test -d java-server && echo "✓ java-server directory exists"
        test -d python-server && echo "✓ python-server directory exists"
        test -d proto && echo "✓ proto directory exists"
        test -d vue-client && echo "✓ vue-client directory exists"